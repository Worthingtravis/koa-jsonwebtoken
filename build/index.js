module.exports=function(e){function r(o){if(t[o])return t[o].exports;var n=t[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,r),n.l=!0,n.exports}var t={};return r.m=e,r.c=t,r.i=function(e){return e},r.d=function(e,r,t){Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:t})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},r.p="",r(r.s=4)}([function(e,r){e.exports=require("es6-promisify")},function(e,r){e.exports=require("jsonwebtoken")},function(e,r){e.exports=require("koa-unless")},function(e,r){e.exports=require("util")},function(e,r,t){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function n(e){return function(){var r=e.apply(this,arguments);return new Promise(function(e,t){function o(n,i){try{var u=r[n](i),s=u.value}catch(e){return void t(e)}return u.done?void e(s):Promise.resolve(s).then(function(e){return o("next",e)},function(e){return o("throw",e)})}return o("next")})}}Object.defineProperty(r,"__esModule",{value:!0}),r.fromAuthorizationHeader=r.fromCookies=r.sign=r.decode=r.verify=void 0;var i=t(1),u=o(i),s=t(2),c=o(s),f=t(3),a=t(0),d=o(a);const l=(0,d.default)(i.verify,u.default);r.verify=i.verify,r.decode=i.decode,r.sign=i.sign,r.default=((e={})=>{if(!e.secret)throw new Error("secret must be specified");if(!e.extractToken||!(0,f.isFunction)(e.extractToken))throw new Error("token extraction strategy must be specified and should be a function");if(e.checkRevoked&&!(0,f.isFunction)(e.checkRevoked))throw new Error("token revokation check must be a function");if(e.doRefresh&&!(0,f.isFunction)(e.doRefresh))throw new Error("token refresh strategy must be specified and should be a function");const{secret,key="user",extractToken,checkRevoked=false,doRefresh=false}=e,r=(()=>{var r=n(function*(r,t){try{const o=extractToken(r,e),n=yield l(o,secret,e);checkRevoked&&(yield checkRevoked(n,e)),r.state=r.state||{},r.state[key]=n,yield t()}catch(o){if("jwt expired"===o.message&&doRefresh)try{const o=h(r,e,!0),n=extractToken(r,e),u=(0,i.decode)(n);yield doRefresh(r,e,o,u),yield t()}catch(e){r.throw(401,`Invalid token - ${e.message}`)}else r.throw(401,`Invalid token - ${o.message}`)}});return function(e,t){return r.apply(this,arguments)}})();return r.unless=c.default,r});const h=r.fromCookies=((e,r,t=false)=>{if(t){if(r.refreshCookie&&e.cookies.get(r.refreshCookie))return e.cookies.get(r.refreshCookie);throw new Error(`the refresh cookie was not found
`)}if(r.cookie&&e.cookies.get(r.cookie))return e.cookies.get(r.cookie);throw new Error(`the specified cookie was not found
`)});r.fromAuthorizationHeader=((e,r)=>{if(!e.header||!e.header.authorization)throw new Error(`can't find authorization header`);const t=e.header.authorization.split(" ");if(2===t.length){const e=t[0],r=t[1];if(/^Bearer$/i.test(e))return r;throw new Error(`Bad Authorization header format. Format is "Authorization: Bearer token"
`)}throw new Error(`Bad Authorization header format. Format is "Authorization: Bearer token"
`)})}]);
//# sourceMappingURL=./build/index.js.map