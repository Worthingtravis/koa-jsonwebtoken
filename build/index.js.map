{"version":3,"sources":["webpack:///index.js","webpack:///webpack/bootstrap 258a5255c1d452d07ddc","webpack:///external \"es6-promisify\"","webpack:///external \"jsonwebtoken\"","webpack:///external \"koa-unless\"","webpack:///external \"util\"","webpack:///./main.js"],"names":["module","exports","modules","__webpack_require__","moduleId","installedModules","i","l","call","m","c","value","d","name","getter","Object","defineProperty","configurable","enumerable","get","n","__esModule","o","object","property","prototype","hasOwnProperty","p","s","require","_interopRequireDefault","obj","default","_asyncToGenerator","fn","gen","apply","this","arguments","Promise","resolve","reject","step","key","arg","info","error","done","then","err","fromAuthorizationHeader","fromCookies","sign","decode","verify","undefined","_jsonwebtoken","_jsonwebtoken2","_koaUnless","_koaUnless2","_util","_es6Promisify","_es6Promisify2","verifyAsync","opts","secret","Error","extractToken","isFunction","checkRevoked","middleware","_ref","ctx","next","accessToken","decodedToken","isRevoked","state","e","msg","message","throw","_x","_x2","unless","cookie","cookies","header","authorization","parts","split","length","scheme","credentials","test"],"mappings":"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","file":"index.js","sourcesContent":["module.exports =\n/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// identity function for calling harmory imports with the correct context\n/******/ \t__webpack_require__.i = function(value) { return value; };\n/******/\n/******/ \t// define getter function for harmory exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tObject.defineProperty(exports, name, {\n/******/ \t\t\tconfigurable: false,\n/******/ \t\t\tenumerable: true,\n/******/ \t\t\tget: getter\n/******/ \t\t});\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 4);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ function(module, exports) {\n\nmodule.exports = require(\"es6-promisify\");\n\n/***/ },\n/* 1 */\n/***/ function(module, exports) {\n\nmodule.exports = require(\"jsonwebtoken\");\n\n/***/ },\n/* 2 */\n/***/ function(module, exports) {\n\nmodule.exports = require(\"koa-unless\");\n\n/***/ },\n/* 3 */\n/***/ function(module, exports) {\n\nmodule.exports = require(\"util\");\n\n/***/ },\n/* 4 */\n/***/ function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.fromAuthorizationHeader = exports.fromCookies = exports.sign = exports.decode = exports.verify = undefined;\n\nvar _jsonwebtoken = __webpack_require__(1);\n\nvar _jsonwebtoken2 = _interopRequireDefault(_jsonwebtoken);\n\nvar _koaUnless = __webpack_require__(2);\n\nvar _koaUnless2 = _interopRequireDefault(_koaUnless);\n\nvar _util = __webpack_require__(3);\n\nvar _es6Promisify = __webpack_require__(0);\n\nvar _es6Promisify2 = _interopRequireDefault(_es6Promisify);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _asyncToGenerator(fn) { return function () { var gen = fn.apply(this, arguments); return new Promise(function (resolve, reject) { function step(key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { return Promise.resolve(value).then(function (value) { return step(\"next\", value); }, function (err) { return step(\"throw\", err); }); } } return step(\"next\"); }); }; }\n\nconst verifyAsync = (0, _es6Promisify2.default)(_jsonwebtoken.verify, _jsonwebtoken2.default);\nconst decodeAsync = (0, _es6Promisify2.default)(_jsonwebtoken.decode, _jsonwebtoken2.default);\n\nexports.verify = _jsonwebtoken.verify;\nexports.decode = _jsonwebtoken.decode;\nexports.sign = _jsonwebtoken.sign;\n\nexports.default = (opts = {}) => {\n\n  if (!opts.secret) {\n    throw new Error(\"secret must be specified\");\n  }\n\n  if (!opts.extractToken || !(0, _util.isFunction)(opts.extractToken)) {\n    throw new Error(\"token extraction strategy must be specified and should be a function\");\n  }\n\n  if (opts.checkRevoked && !(0, _util.isFunction)(opts.checkRevoked)) {\n    throw new Error(\"token revokation check must be a function\");\n  }\n\n  const {\n    secret,\n    key = \"user\",\n    extractToken,\n    checkRevoked = false\n  } = opts;\n\n  const middleware = (() => {\n    var _ref = _asyncToGenerator(function* (ctx, next) {\n      try {\n        const accessToken = extractToken(ctx, opts);\n        const decodedToken = yield verifyAsync(accessToken, secret, opts);\n        const isRevoked = checkRevoked ? yield checkRevoked(decodedToken, opts) : false;\n        if (isRevoked) {\n          throw new Error(\"jwt revoked\");\n        }\n        ctx.state = ctx.state || {};\n        ctx.state[key] = decodedToken;\n        yield next();\n      } catch (e) {\n        const msg = `Invalid token - ${ e.message }`;\n        ctx.throw(401, msg);\n      }\n    });\n\n    return function middleware(_x, _x2) {\n      return _ref.apply(this, arguments);\n    };\n  })();\n\n  middleware.unless = _koaUnless2.default;\n\n  return middleware;\n};\n\nconst fromCookies = exports.fromCookies = (ctx, opts) => {\n  if (opts.cookie && ctx.cookies.get(opts.cookie)) {\n    return ctx.cookies.get(opts.cookie);\n  } else {\n    throw new Error(`the specified cookie was not found\\n`);\n  }\n};\n\nconst fromAuthorizationHeader = exports.fromAuthorizationHeader = (ctx, opts) => {\n  if (!ctx.header || !ctx.header.authorization) {\n    throw new Error(`can't find authorization header`);\n  }\n\n  const parts = ctx.header.authorization.split(\" \");\n\n  if (parts.length === 2) {\n    const scheme = parts[0];\n    const credentials = parts[1];\n\n    if (/^Bearer$/i.test(scheme)) {\n      return credentials;\n    } else {\n      throw new Error(`Bad Authorization header format. Format is \"Authorization: Bearer token\"\\n`);\n    }\n  } else {\n    throw new Error(`Bad Authorization header format. Format is \"Authorization: Bearer token\"\\n`);\n  }\n};\n\n/***/ }\n/******/ ]);\n\n\n// WEBPACK FOOTER //\n// index.js"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmory imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmory exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tObject.defineProperty(exports, name, {\n \t\t\tconfigurable: false,\n \t\t\tenumerable: true,\n \t\t\tget: getter\n \t\t});\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 4);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 258a5255c1d452d07ddc","module.exports = require(\"es6-promisify\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"es6-promisify\"\n// module id = 0\n// module chunks = 0","module.exports = require(\"jsonwebtoken\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"jsonwebtoken\"\n// module id = 1\n// module chunks = 0","module.exports = require(\"koa-unless\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-unless\"\n// module id = 2\n// module chunks = 0","module.exports = require(\"util\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"util\"\n// module id = 3\n// module chunks = 0","import jwt, { verify, decode, sign } from \"jsonwebtoken\";\nimport unless from \"koa-unless\";\nimport { isFunction } from \"util\";\nimport promisify from \"es6-promisify\";\n\nconst verifyAsync = promisify(verify, jwt);\nconst decodeAsync = promisify(decode, jwt);\n\nexport { verify, decode, sign };\n\nexport default (opts = {}) => {\n\n  if (!opts.secret) {\n    throw new Error(\"secret must be specified\");\n  }\n\n  if (!opts.extractToken || !isFunction(opts.extractToken)) {\n    throw new Error(\"token extraction strategy must be specified and should be a function\");\n  }\n\n  if (opts.checkRevoked && !isFunction(opts.checkRevoked)) {\n    throw new Error(\"token revokation check must be a function\");\n  }\n\n  const {\n    secret,\n    key = \"user\",\n    extractToken,\n    checkRevoked = false\n  } = opts;\n\n  const middleware =  async (ctx, next) => {\n    try {\n      const accessToken = extractToken(ctx, opts);\n      const decodedToken = await verifyAsync(accessToken, secret, opts);\n      const isRevoked = checkRevoked ? await checkRevoked(decodedToken, opts) : false;\n      if (isRevoked) {\n        throw new Error(\"jwt revoked\");\n      }\n      ctx.state = ctx.state || {};\n      ctx.state[key] = decodedToken;\n      await next();\n    } catch (e) {\n      const msg = `Invalid token - ${e.message}`;\n      ctx.throw(401, msg);\n    }\n  }\n\n  middleware.unless = unless;\n\n  return middleware;\n\n}\n\nexport const fromCookies = (ctx, opts) => {\n  if (opts.cookie && ctx.cookies.get(opts.cookie)) {\n    return ctx.cookies.get(opts.cookie);\n  } else {\n    throw new Error(`the specified cookie was not found\\n`);\n  }\n}\n\nexport const fromAuthorizationHeader = (ctx, opts) => {\n  if (!ctx.header || !ctx.header.authorization) {\n    throw new Error(`can't find authorization header`);\n  }\n\n  const parts = ctx.header.authorization.split(\" \");\n\n  if (parts.length === 2) {\n    const scheme = parts[0];\n    const credentials = parts[1];\n\n    if (/^Bearer$/i.test(scheme)) {\n      return credentials;\n    } else {\n      throw new Error(`Bad Authorization header format. Format is \"Authorization: Bearer token\"\\n`);\n    }\n  } else {\n    throw new Error(`Bad Authorization header format. Format is \"Authorization: Bearer token\"\\n`);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./main.js"],"sourceRoot":""}