{"version":3,"sources":["webpack:///webpack/bootstrap 258a5255c1d452d07ddc","webpack:///external \"es6-promisify\"","webpack:///external \"jsonwebtoken\"","webpack:///external \"koa-unless\"","webpack:///external \"util\"","webpack:///./main.js"],"names":["verifyAsync","decodeAsync","verify","decode","sign","opts","secret","Error","extractToken","checkRevoked","key","middleware","ctx","next","accessToken","decodedToken","isRevoked","state","e","msg","message","throw","unless","fromCookies","cookie","cookies","get","fromAuthorizationHeader","header","authorization","parts","split","length","scheme","credentials","test"],"mappings":"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","file":"index.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmory imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmory exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tObject.defineProperty(exports, name, {\n \t\t\tconfigurable: false,\n \t\t\tenumerable: true,\n \t\t\tget: getter\n \t\t});\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 4);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 258a5255c1d452d07ddc","module.exports = require(\"es6-promisify\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"es6-promisify\"\n// module id = 0\n// module chunks = 0","module.exports = require(\"jsonwebtoken\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"jsonwebtoken\"\n// module id = 1\n// module chunks = 0","module.exports = require(\"koa-unless\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-unless\"\n// module id = 2\n// module chunks = 0","module.exports = require(\"util\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"util\"\n// module id = 3\n// module chunks = 0","import jwt, { verify, decode, sign } from \"jsonwebtoken\";\nimport unless from \"koa-unless\";\nimport { isFunction } from \"util\";\nimport promisify from \"es6-promisify\";\n\nconst verifyAsync = promisify(verify, jwt);\nconst decodeAsync = promisify(decode, jwt);\n\nexport { verify, decode, sign };\n\nexport default (opts = {}) => {\n\n  if (!opts.secret) {\n    throw new Error(\"secret must be specified\");\n  }\n\n  if (!opts.extractToken || !isFunction(opts.extractToken)) {\n    throw new Error(\"token extraction strategy must be specified and should be a function\");\n  }\n\n  if (opts.checkRevoked && !isFunction(opts.checkRevoked)) {\n    throw new Error(\"token revokation check must be a function\");\n  }\n\n  const {\n    secret,\n    key = \"user\",\n    extractToken,\n    checkRevoked = false\n  } = opts;\n\n  const middleware =  async (ctx, next) => {\n    try {\n      const accessToken = extractToken(ctx, opts);\n      const decodedToken = await verifyAsync(accessToken, secret, opts);\n      const isRevoked = checkRevoked ? await checkRevoked(decodedToken, opts) : false;\n      if (isRevoked) {\n        throw new Error(\"jwt revoked\");\n      }\n      ctx.state = ctx.state || {};\n      ctx.state[key] = decodedToken;\n      await next();\n    } catch (e) {\n      const msg = `Invalid token - ${e.message}`;\n      ctx.throw(401, msg);\n    }\n  }\n\n  middleware.unless = unless;\n\n  return middleware;\n\n}\n\nexport const fromCookies = (ctx, opts) => {\n  if (opts.cookie && ctx.cookies.get(opts.cookie)) {\n    return ctx.cookies.get(opts.cookie);\n  } else {\n    throw new Error(`the specified cookie was not found\\n`);\n  }\n}\n\nexport const fromAuthorizationHeader = (ctx, opts) => {\n  if (!ctx.header || !ctx.header.authorization) {\n    throw new Error(`can't find authorization header`);\n  }\n\n  const parts = ctx.header.authorization.split(\" \");\n\n  if (parts.length === 2) {\n    const scheme = parts[0];\n    const credentials = parts[1];\n\n    if (/^Bearer$/i.test(scheme)) {\n      return credentials;\n    } else {\n      throw new Error(`Bad Authorization header format. Format is \"Authorization: Bearer token\"\\n`);\n    }\n  } else {\n    throw new Error(`Bad Authorization header format. Format is \"Authorization: Bearer token\"\\n`);\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./main.js"],"sourceRoot":""}